#Code #1
// index ของไอเท็มปัจจุบัน (รองรับทั้ง $input.itemIndex และ $itemIndex)
const idx = ($input?.itemIndex ?? $itemIndex ?? 0);

// ดึงรายการจาก node "Build vPins"
const vpins = $items('Build vPins', 0); // ← ชื่อ node ต้องตรงเป๊ะ
const prev  = vpins?.[idx]?.json;

// ถ้าแมตช์ไม่ได้ ให้ส่ง error-friendly payload กลับไปแทนจะได้ดีบักง่าย
if (!prev) {
  return {
    json: {
      error: `No matching vPin at index ${idx}. Check node name "Build vPins" and connection order.`,
      idx,
      have_vpins: Array.isArray(vpins) ? vpins.length : 0,
      raw_input: $json
    }
  };
}
